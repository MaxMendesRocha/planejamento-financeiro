<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Planejamento Financeiro</title>
    <link rel="stylesheet" href="/css/style.css?v=<%= Date.now() %>">
</head>
<body>
    <%- include('partials/navbar', { userName, active: 'dashboard' }) %>
    
    <div class="container">
        <div class="page-header">
            <h1>ğŸ“Š Dashboard Financeiro</h1>
            <p class="subtitle">VisÃ£o geral do seu planejamento</p>
        </div>
        
        <!-- Cards de Resumo -->
        <div class="dashboard-cards">
            <div class="stat-card">
                <div class="stat-icon">ğŸ’µ</div>
                <div class="stat-content">
                    <p class="stat-label">Renda Total</p>
                    <h2 class="stat-value">R$ <%= totalRendas.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></h2>
                </div>
            </div>
            
            <div class="stat-card necessidades">
                <div class="stat-icon">ğŸ </div>
                <div class="stat-content">
                    <p class="stat-label">Necessidades (<%= config.percentual_necessidades %>%)</p>
                    <h2 class="stat-value">R$ <%= necessidades.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></h2>
                    <p class="stat-small">Gasto: R$ <%= despesas.necessidades.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                </div>
            </div>
            
            <div class="stat-card desejos">
                <div class="stat-icon">ğŸ¨</div>
                <div class="stat-content">
                    <p class="stat-label">Desejos (<%= config.percentual_desejos %>%)</p>
                    <h2 class="stat-value">R$ <%= desejos.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></h2>
                    <p class="stat-small">Gasto: R$ <%= despesas.desejos.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                </div>
            </div>
            
            <div class="stat-card poupanca">
                <div class="stat-icon">ğŸ’</div>
                <div class="stat-content">
                    <p class="stat-label">PoupanÃ§a (<%= config.percentual_poupanca %>%)</p>
                    <h2 class="stat-value">R$ <%= poupanca.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></h2>
                    <p class="stat-small">Guardado: R$ <%= despesas.poupanca.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                </div>
            </div>
        </div>
        
        <!-- Progresso das Metas -->
        <div class="card">
            <div class="card-header">
                <h2>ğŸ¯ Reserva de EmergÃªncia (DinÃ¢mica)</h2>
                <p style="color: var(--muted-foreground); font-size: 0.9rem; margin-top: 0.5rem;">
                    Baseada em 6 meses de suas despesas mÃ©dias mensais
                </p>
            </div>
            <div class="meta-progress">
                <% if (despesaMediaMensal > 0) { %>
                    <div class="meta-info">
                        <p><strong>Despesa MÃ©dia Mensal:</strong> R$ <%= despesaMediaMensal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                        <p><strong>Meta (6 meses):</strong> R$ <%= (metaReserva.valor_meta || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                        <p><strong>Guardado em PoupanÃ§a:</strong> R$ <%= (metaReserva.valor_atual || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                        <% const faltaGuardar = Math.max(0, (metaReserva.valor_meta || 0) - (metaReserva.valor_atual || 0)); %>
                        <p><strong>Falta Guardar:</strong> R$ <%= faltaGuardar.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                    </div>
                    <div class="progress-bar">
                        <% const progressoMeta = metaReserva.valor_meta > 0 ? ((metaReserva.valor_atual || 0) / metaReserva.valor_meta * 100) : 0; %>
                        <div class="progress-fill" style="width: <%= Math.min(progressoMeta, 100).toFixed(1) %>%;">
                            <%= Math.min(progressoMeta, 100).toFixed(1) %>%
                        </div>
                    </div>
                    <% if (progressoMeta >= 100) { %>
                        <div class="alert alert-success" style="margin-top: 1rem;">
                            âœ… ParabÃ©ns! VocÃª atingiu sua meta de reserva de emergÃªncia!
                        </div>
                    <% } %>
                <% } else { %>
                    <div class="alert alert-info">
                        â„¹ï¸ Comece a cadastrar suas despesas mensais para calcular automaticamente sua reserva de emergÃªncia ideal.
                    </div>
                    <p style="margin-top: 1rem; color: var(--muted-foreground);">
                        A reserva serÃ¡ calculada como <strong>6 meses</strong> de suas despesas mÃ©dias mensais (necessidades + desejos).
                    </p>
                <% } %>
            </div>
        </div>
        
        <!-- GrÃ¡ficos de Despesas -->
        <div class="grid-2">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“ˆ OrÃ§amento vs Realizado</h2>
                </div>
                <div class="comparison-bars">
                    <div class="bar-group">
                        <label>Necessidades</label>
                        <div class="bar-container">
                            <div class="bar budget">R$ <%= necessidades.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></div>
                            <div class="bar actual necessidades-bg" style="width: <%= Math.min((despesas.necessidades / necessidades * 100), 100) %>%;">
                                R$ <%= despesas.necessidades.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bar-group">
                        <label>Desejos</label>
                        <div class="bar-container">
                            <div class="bar budget">R$ <%= desejos.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></div>
                            <div class="bar actual desejos-bg" style="width: <%= Math.min((despesas.desejos / desejos * 100), 100) %>%;">
                                R$ <%= despesas.desejos.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bar-group">
                        <label>PoupanÃ§a</label>
                        <div class="bar-container">
                            <div class="bar budget">R$ <%= poupanca.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></div>
                            <div class="bar actual poupanca-bg" style="width: <%= Math.min((despesas.poupanca / poupanca * 100), 100) %>%;">
                                R$ <%= despesas.poupanca.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ’¡ AÃ§Ãµes RÃ¡pidas</h2>
                </div>
                <div class="quick-actions">
                    <a href="/despesas" class="action-button">
                        <span class="action-icon">â•</span>
                        <span>Adicionar Despesa</span>
                    </a>
                    <a href="/rendas" class="action-button">
                        <span class="action-icon">ğŸ’°</span>
                        <span>Gerenciar Rendas</span>
                    </a>
                    <a href="/metas" class="action-button">
                        <span class="action-icon">ğŸ¯</span>
                        <span>Ver Metas</span>
                    </a>
                    <a href="/configuracoes" class="action-button">
                        <span class="action-icon">âš™ï¸</span>
                        <span>ConfiguraÃ§Ãµes</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
